# TwoRegionsConstrained

This directory contains Matlab/C program files for the computational models (reducing firing rate and large LIF spiking) 
and the data processing.  All commands below are to be performed in Matlab.

Citation: Barreiro, Hari Gautaum, Shew, & Ly (2017). 
A Theoretical Framework for Analyzing Coupled Neuronal Networks: Application to the Olfactory System. 
PLoS Computational Biology (10), Vol. 13: pp. e1005780. http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005780 
DOI: 10.1371/journal.pcbi.1005780


Sub-directories: 
~/experimentalData/ — contains the raw experimental data from the simultaneous dual multi-electrode arrays in 
  the Olfactory Bulb (OB) and Anterior Piriform Cortex (PC), and the code to plot/analyze 
~/reducedRateModel/ — contains code for Monte Carlo simulations of the coupled firing rate (Wilson-Cowan) models, 
  as well as the reduced method, and mat files for parameters/realizations/saved results
~/spikingLIFmodel/ — contains code and stored data for Monte Carlo simulations of the coupled LIF spiking model


EXPLANATION FOR HOW TO PRODUCE FIGURES IN THE PAPER:
(see EXPLANATION OF FILES for further details)

Figure 1 — files in /experimentalData/
A) and B) run get_psth.m (uses processDataSelect.m, exclude_bad_units.m, extract_counts.m)
C) and D) run disp_Fig1CD; loads fRate_all.mat which is the combined firing rate from both experiments 
  (created via running get_firing_rates.m on both datasets)

Figures 2, 3 — files in /experimentalData/
Run the script dispTwinBoth_stdErr.m, will show all of the sub-figures as well as others NOT in the paper

Figure 4, S11 — files in /reducedRateModel/
Run the script disp_Results.m, will show all sub-figures (4 panels in Fig 4, 2 panels in Fig S11; 6 total plots)

Figure 5 — files in /reducedRateModel/
Run the script ap_stateChange.m , press any key a few times; the last figure that pops up is Fig 5A.
Run the script check_Constr_MC.m , the last figure that pops up is Fig 5B.

Figure 6 — files in /spikingLIFmodel/
Run the script dispConstr_SponEvk.m, show all 8 figures and 4 firing rate constraints (12 total); loads data d_spnHet.mat 
and d_evkHet.mat, results of LIF simulations from scpt_rnMx_spn.m and scpt_rnMx_evk.m, which called the 
mex-function mx_jCorv_LIF2Pop_delay.c 
[MUST compile in Matlab before; >> mex mx_jCorV_LIF2Pop_delay.c]

Numerical results in “Admissible firing rate parameters” section:
Run check_Constr_MC.m to see mean g values, largest eigen vector in SVD, and Percent of Var explained by SVD; 
numerical results displayed in command window.

Table S1 & S1 — files in /experimentalData/
Values obtained from running get_firing_rates.m and manually calculating stats on OB_od1, OB_od2 
(evoked OB, 1st and 2nd odor), OB_spon1, OB_spon2 (spon OB, 1st and 2nd odor), 
similarly for PC_od1, PC_od2, PC_spon1, PC_spon2

Figures S1 & S2 - files in /experimentalData/
Run zplot_byOdor_FF_spEvk.m and enter which dataset to observe

Figure S3 & S4 — files in /experimentalData/
Run zplot_byOdor_FF_pcVob.m and enter which dataset to observe

Figures S5 & S6 — files in /experimentalData/
Run zplot_byOdor_spEvk.m and enter which dataset to observe

Figure S7 & S8 — files in /experimentalData/
Run zplot_byOdor_pcVob.m and enter which dataset to observe

Figure S9 — files in /experimentalData/
Can easily be generated manually after running dispTwinBoth_stdErr.m

Figure S10 — files in /reducedRateModel/
Run script plots_FigS10.m, loads dcfMcAn_rndSmpl_Sp.mat (see explanation below)

Figure S12 — files in /reducedRateModel/
Easily obtained by altering transfer function in iter_method.m and connectivity matrix in find_svStats_[sp/ev].m

Figure S13 — files in /spikingLIFmodel/
Similar to Figure 6 above, but replace d_evkHet.mat with d_evkFixPCmu_Supp.mat (keep same d_spnHet.mat) in 
dispConstr_SponEvk.m

Figure S14, S15, S16 — files in /spikingLIFmodel/
Similar to Figure 6 above, but replace d_spnHet.mat with d_spn_Viol_[1,2,3].mat and d_evkHet.mat with 
d_evk_Viol_[1,2,3].mat in dispConstr_SponEvk.m script; 1 corresponds to Test 1 (Fig S14), etc.  These mat files were 
generated by altering scpt_rnMx_[spn/evk].m by changing conductance strengths on Lines 17–28 (& mat file name to be saved).

Figures S17 — S21 are very much like Figures 4, S11, 6, S14, S15, S16, so all that is needed is to change the 
parameters in the specified ways

EXPLANATION OF FILES:

1) Files in /experimentalData/
data040515_exp1+2.mat — raw data, contains 5 variables: aPCspiketimes (vector of spike times for PC  cells, in seconds); 
  aPCuid (corresponding cell identity, vector of same length as aPCspiketimes); OBspiketimes (vector of spike times for 
  OB cells, in seconds); OBuid (corresponding cell identity, vector of same length as OBspiketimes); stimtimes 
  (vector of the 20 stimulation times, stimulus held for 2 secs), with Hexanal odor (see Materials and Methods for 
  further details)
data040515_exp3+4.mat — similar to previous file but with Ethyl Butyrate odor
dFrate_all.mat — manually saved firing rates, obtained from running get_firing_rates.m on BOTH datasets and combining
dFrate_all.mat — The time & trial averaged firing rate for all OB and PC cells from BOTH datasets; spontaneous (_sp) 
  and evoked (_ev)
CoVar_Both.mat — the calculated spiking count stats as a function of window size for BOTH datasets, saving only the 
  mean and std dev across all cells (or pairs). Run sve_TwinBoth.m to create CoVar_Both.mat
CoVar_Exp1+2.mat — Same stats as CoVar_Both but for only 2 odors 
CoVar_Exp3+4.mat — Same stats as CoVar_Both but for only 2 odors  

dispTwinBoth_stdErr.m — Plots many (almost all) data figures, as function of time window, with data combined from both 
  experiments.  Loads the data from CoVar_Both.mat 
exclude_bad_units.m — function to implement criteria for excluding ‘bad’ units (see Materials and Methods of paper)
disp_Fig1CD.m — plots the firing rate histograms in spontaneous & evoked states (Figs 1C and 1D)
extract_counts.m — helper function to process experimental data
get_firing_rates.m — script to calc time and trial-avg firing rates for both OB and PC, uses extract_counts.m, 
  exclude_bad_units.m
get_psth.m — script to calc PSTH over population (and in individual units)
histf.m — function for flexible histogram plots (necessary for Matlab 2014a and below), 
  written by: Chad A. Greene of the University of Texas at Austin's Institute for Geophysics (UTIG). August 2014. 
  Downloaded from Matlab Central File Exchange.
processDataSelect.m — helper function to process experimental data (calls on exclude_bad_units.m, extract_counts.m)
shadedErrorBar.m — function for shaded error bars plot, written by: Rob Campbell - November 2009.  
  Downloaded from Matlab Central File Exchange.
sve_TwinBoth.m — script to extract experimental data (spike count statistics) as a function of time window, 
  uses processDataSelect.m — this script shows the ENTIRE spike count stat distribution
zplot_byOdor_FF_spEvk.m — Fig S1 & S2, loads CoVar_Exp1+2.mat OR CoVar_Exp3+4.mat (depending on user input)
zplot_byOdor_FF_pcVob.m — Fig S3 & S4, loads CoVar_Exp1+2.mat OR CoVar_Exp3+4.mat (depending on user input)
zplot_byOdor_spEvk.m — Figs S5 & S6, loads CoVar_Exp1+2.mat OR CoVar_Exp3+4.mat (depending on user input)
zplot_byOdor_pcVob.m — Fig S7 & S8, loads CoVar_Exp1+2.mat OR CoVar_Exp3+4.mat (depending on user input)

2) Files in /reducedRateModel/
ap_stateChange.m — script to determine which sets (among 20^4) satisfy all 12 constraints; saves results in 
  dBothSpEv_st.mat; calls saved reduced model results in dSp_st.mat, dEv_st.mat.  MUST press a key b/c script pauses.. (to study results), also plots the bar graph in Fig 5A
disp_Results.m — script to make 6 plots comparing combinations (of 2) g’s; relies on mat files: dBothSpEv_st.mat 
  and dBothSt_MC
find_svStats_ev.m — Computes all 1st/2nd order stats in firing rate model via function iter_method.m for 20^4 
  parameter sets (VERY LONG SIM), using parameters to model evoked state (Parms_evoked.mat), saves results in dEv_st.mat 
  (Parms_spont.mat), saves results in dSp_st.mat
iter_method.m — Implements the iterative fast solver; returns the reasonably accurate approximation (when coupling is weak)
mc_sixWC.m — function that implements Monte Carlo simulation of 6 coupled firing rate (Wilson-Cowan)
cfMC_Analyt_svValidP_ev.m — only run AFTER find_svStats_ev.m is run; script to calculate Monte Carlo sims on 
  valid parameter sets, calls function mx_sixWC.m, saves results in dcfMcAn_Ev.mat
cfMC_Analyt_svValidP_sp.m — only run AFTER find_svStats_sp.m is run; script to calculate Monte Carlo sims on 
  valid parameter sets, calls function mx_sixWC.m, saves results in dcfMcAn_Sp.mat 
cfMC_Analyt_rndSmpl_EB — script to show reduced method comparison to Monte Carlo on a random sample; 
  !! MUST first compile mex [>> mex mx_WCebt.c]!!
check_Constr_MC.m — similar to ap_stateChange.m but checks 12 constraints using Monte Carlo on the ‘valid sets’ 
  from the reduced method; also outputs the mean g’s, SVD and other results, as well as Fig 5B
plots_FigS10.m — Script to plot figure S10 showing Monte Carlo sims compared to our reduced method (with error bars), 
  loads dcfMcAn_rndSmpl_sp.mat (see below)
 
dBothSpEv_st.mat — created by the script ap_stateChange.m that determines which sets satisfy all 12 data constraints; 
  loads model results saved in dSp_st.mat, dEv_st.mat
dBothSt_MC.mat — created by the script check_Constr_MC.m, contains the final set of parameters from Analytic Method 
  AND Monte Carlo that 
satisfy all 12 constraints (vector of size 1771 b/c subset of finPrm (which has exactly 1771 sets))
dcfMcAn_Ev.mat — spike stats saved from Monte Carlo sims on valid sets from find_svStats[].m, created in 
  cfMC_Analyt_svValidP_ev.m 
dcfMcAn_Sp.mat — spike stats saved from Monte Carlo sims on valid sets from find_svStats[].m, created in 
  cfMC_Analyt_svValidP_sp.m
dcfMcAn_rndSmpl_sp.mat — generated from cfMC_Analyt_rndSmpl_EB.m
dEv_st.mat — spike stats approximation results from all 20^4 parameters (evoked state)
dSp_st.mat — spike stats approximation results from all 20^5 parameters (spontaneous state)
Parms_evoke.mat — Contains intrinsic parameters for OB & PC (mu, sig, s_sp, s_rv) in evoked state; note that background 
  correlation value for PC is changed in find_svStats_ev.m 
Parms_spont.mat — Similar to Parms_evoked;  note that background correlation value for PC is changed in find_svStats_sp.m 
mx_WCebt.c — Mex file for calculating Monte Carlo sim of 6 coupled firing-rate, giving error bars 


3) Files in /spikingLIFmodel/
creat_IC.m — created the file netParms.mat; !!!NOTE, if you run this script again, netParms.mat will be overwritten and 
  won’t get exact match to our figures/sims due to noise!!!
scpt_rnMx_evk.m — script for running the main LIF model in paper (Fig 5), evoked state
scpt_rnMx_spn.m — script for running the main LIF model in paper (Fig 5), spontaneous state
d_spnHet.mat — saved stats from scpt_rnMx_spn.m
d_evkHet.mat — saved stats from scpt_rnMx_evk.m 
d_spn_Viol_[1,2,3].mat — results of spont state sims under Test 1, 2, 3 (see main text)
d_evk_Viol_[1,2,3].mat — results of evoked state sims under Test 1, 2, 3 (see main text)
d_evkFixPCmu_Supp.mat — result of fixing mu in PC (for Fig S12)
netParms.mat - 250 OB, 250 PC, with 30% conn; for saving 20% correl/cov within region with lognormal thresholds 
  (see file creat_IC.m for details)
